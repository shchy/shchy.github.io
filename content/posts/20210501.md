---
title: "K3S🛴"
date: 2021-05-01T22:28:13+09:00
draft: false
tags:
- "52steps"
- k9s
- k3s
- digitalocean
---

アプリをホストするサーバはDigitalOceanにする。  
仕事ではなんとなくAWSが多い気がするが、おじさんはメジャーなものはあんまり好きじゃないのである。  
DigitalOceanは５年くらい無駄に五百円払い続けてたという実績を持っているのでベテランである。  
k8sならどこで動いているかはあんまり関係ないのである。（コンピューティングサービス使うだけなら）  

と思ったらk8sを使うには1000円💵かかる。ワンコイン🪙じゃないのか。  
社内に作ったのと同じように500円サーバにk8sをbaremetalで構築すれば良いのではないかと閃いたが、500円では1cpuなので無理っぽい。  
この機会にk3sを試してみた。  

1. アカウント作ってCreateボタンからDropletを選択  
![](/imgs/20210501/00.png)  

2. `Choose an image`から`Container distributions`を選択して`RancherOS`を選択  
![](/imgs/20210501/01.png)  

3. `Authentication`の`New SSHKey`ボタン押して接続用のkeyを入力  
※済なら選ぶだけ  
※他のCPUとかの設定は値段を気にしながら適当に選ぶ  
![](/imgs/20210501/02.png)  

4. 作ったDropletを選択するとIPが確認できる(赤い塗りつぶしのとこ)のでSSH接続する  
`ssh rancher@<IP>`  
![](/imgs/20210501/03.png)  
  

5. rancherOSのconsoleをubuntuに切り替える  
一回接続切れるので再度SSHで接続する  
```shell
sudo ros console switch ubuntu
```  

6. [ここ](https://github.com/k3s-io/k3s/releases)から`k3s`バイナリのURLをコピーしてcurlでバイナリをダウンロード  
```sh
sudo curl -L "https://github.com/k3s-io/k3s/releases/download/v1.21.0%2Bk3s1/k3s" -o /usr/local/bin/k3s
sudo chmod +x /usr/local/bin/k3s
```

7. k3sの起動
```sh
sudo k3s server &
```

8. configファイルの場所  
以下のファイルをローカルの`~/.kube/config`にダウンロード  
```sh
/etc/rancher/k3s/k3s.yaml
```

9. 接続確認  
ssh切断してローカルで`kubectl`とか`k9s`が使えるかどうか確認  
```sh
kubectl get all -A
```



